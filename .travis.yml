dist: bionic
language: python
cache: pip
python:
  - "3.8"

sudo: required
services:
  - docker

install:
jobs:
  include:
    - stage: release_develop
      if: branch = develop AND type != pull_request
      script:
        - |
          echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
          docker build -t mpib/lagerregal:develop .
          docker run --rm mpib/lagerregal:develop ./manage.py test
          docker push mpib/lagerregal:develop
    - stage: release_master
      if: branch = master AND type != pull_request
      script:
        - |
          echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
          docker build -t mpib/lagerregal:latest .
          docker run --rm mpib/lagerregal:latest ./manage.py test
          docker push mpib/lagerregal:latest
