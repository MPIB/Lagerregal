{% extends "base.html" %}
{% load i18n %}

{% block title %}{{device.name}}{% endblock %}

{% block header %}
{% trans "Device" %}: {{device.name}}
{% endblock %}

{% block pullright %}
{% if device.archived == None %}
  <a href="{% url 'device-delete' device.id %}" class="button alert right small" style="margin-left:10px">{% trans "Delete" %}</a>
  <a href="{% url 'device-archive' device.id %}" class="button alert right small" style="margin-left:10px">{% trans "Archive" %}</a>
<a href="{% url 'device-add-copy' device.id %}" class="button small right" style="margin-left:10px">{% trans "Create Copy" %}</a>
  <a href="{% url 'device-edit' device.id %}" class="button small right" style="margin-left:10px">{% trans "Edit" %}</a>
  {% if device.currentlending != None %}
    <a href="{% url 'device-return' device.id %}" class="button success right small"style="margin-left:10px">{% trans "Mark as returned" %}</a>
  {% else %}
    <a href="{% url 'device-lend' device.id %}" class="button success right small"style="margin-left:10px">{% trans "Mark as Lendt" %}</a>
  {% endif %}
{% else %}
  <a href="{% url 'device-archive' device.id %}" class="button alert right small" style="margin-left:10px">{% trans "Unarchive" %}</a>
{% endif %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="small-12 large-4 columns">
    <table>
      <tbody>
        <tr><td>{% trans "Bildnumber" %}</td><td>{{device.bildnumber}}</td></tr>
        <tr><td>{% trans "Serialnumber" %}</td><td>{{device.serialnumber}}</td></tr>
        <tr><td>{% trans "MAC-Address" %}</td><td>{{device.macaddress}}</td></tr>
        <tr><td>{% trans "Devicetype" %}</td><td>{{device.devicetype}}</td></tr>
        <tr><td>{% trans "Manufacturer" %}</td><td>{{device.manufacturer}}</td></tr>
        <tr><td>{% trans "Room" %}</td><td>{{device.room}}</td></tr>
        <tr><td>{% trans "Created by" %}</td><td><a href="{% url 'userprofile' device.creator.pk %}">{{ device.creator }}</a></td></tr>
      </tbody>
    </table>
{% if device.webinterface != "" %}<a href="{{device.webinterface}}" target="_blank">{% trans "Go to webinterface" %}</a>{% endif %}
<h4>{% trans "Current Lending information" %}</h4>
    {% if device.currentlending != None %}
      <table>
      <tbody>
        <tr><td>{% trans "Lendt to" %}</td><td>{{device.currentlending.owner}}</td></tr>
        <tr><td>{% trans "Since" %}</td><td>{{device.currentlending.lenddate}}</td></tr>
        <tr><td>{% trans "Due to" %}</td><td>{{device.currentlending.duedate}}
{% if device.currentlending.duedate < weekago %}<span class="error-icon">!</span>
{% elif device.currentlending.duedate < today %}<span class="warning-icon">!</span>
{% endif %}
<tr><td>{% trans "Overdue notification" %}</td><td>{{device.currentlending.duedate_email|default_if_none:"Not sent"}}</td></tr>
</td></tr>
      </tbody>
    </table>
    {% else %}
    <p>{% trans "Currently not lent" %}</p>
    {% endif %}

{% if lending_list %}
<h4>{% trans "Lending history" %}</h4>
    <table width="100%">
  <thead>
    <tr>
      <th>{% trans "User" %}</th>
      <th>{% trans "Since" %}</th>
      <th>{% trans "Duedate" %}</th>
      <th>{% trans "Returned" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for lending in lending_list %}
    <tr>
      <td><a href="{% url 'userprofile' lending.owner.pk %}">{{lending.owner}}</a></td>
      <td>{{lending.lenddate}}</td>
      <td>{{lending.duedate|default_if_none:"never"}}</td>
      <td>{{lending.returndate|default_if_none:"not returned"}}</td>
    </tr>
     {% endfor %}
  </tbody>
</table>
{% endif %}

    <a href="{% url 'device-history-list' device.pk %}">{% trans "View edit-history" %}</a>
  </div>
<div class="small-12 large-4 columns">
{{device.description}}
</div>
  <div class="small-12 large-4 columns">
    <ul class="pricing-table">
      <li class="title">{% trans "IP-Addresses" %}</li>
      {% for address in ipaddress_list %}
        <li class="bullet-item">{{address.address}} <a href="{% url 'device-ipaddress-remove' device.pk address.pk %}" class="close delete right">x</a></li>
      {% endfor %}
      {% if device.archived == None %}
      <li class="cta-button"><form method="post" action="{% url 'device-ipaddress' device.pk %}" style="margin:0px;">{% csrf_token %}
        <div class="row">
      <div class="large-12 columns">
        {{ipaddressform.ipaddresses}}
      </div>
    </div>
        <div class="row"  style="margin-top:10px;">
      <div class="large-12 columns">

        <input type="submit" class ="button small right" value="{% trans "Assign Addresses" %}">
      </div>
    </div>
    <input type="hidden" name="device" value="{{ device.pk }}" />
      </form></li>
    </ul>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scriptend %}
$("#id_ipaddresses").select2({
    tokenSeparators: [",", " "]});
{% endblock %}