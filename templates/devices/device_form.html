{% extends "base.html" %}
{% load i18n %}
{% load devicetags %}
{% block title %}{{actionstring}} {% if object != None %}{{object}}{% else %}Object{% endif %}{% endblock %}

{% block header %}{{actionstring}} {% if object != None %}{{object}}{% else %}Object{% endif %}{% endblock %}
{% block content %}
<div class="row">
  <div class="small-12 large-6 large-centered columns panel">
<form action="" method="post" class="form-horizontal">{% csrf_token %}
{% for field in form %}
{% if field.html_name == "creator" %}
{{ field }}
{% else %}
{% if field.html_name == "room" %}</div>{% endif %}
<div class="row {{field.css_classes}}">
        <div class="small-3 columns"> 
          <label for="right-label" class="right inline"{% if field.field.required %}style="font-weight:bold"{% endif %}>{{ field.label }}</label>
        </div>
        <div class="small-{% if field|is_select %}8{% else %}9{% endif %} columns">
         {{ field }}
{% if field.errors %}<small style="padding-top:20px">{% for error in field.errors %}{{error}}, {% endfor %}</small>{% endif %}
        </div>
        {% if field|is_select %}<div class="small-1 columns"><a href="#" class="modalbutton" data-classname="{{field.html_name}}" data-name="{{field.label}}"><i class="icon-plus"></i></a></div>{% endif %}
      </div>
{% endif %}
{% if field.html_name == "devicetype" %}<div id="extra_attributes">{% endif %}
{% endfor %}
<input type="submit" value="{% trans "Submit" %}" class="button button-primary" />
</form>

</div>
</div>

<div id="addModal" class="reveal-modal">
  <h2>Create new <span id="modal_header"></span></h2>
  <form action="" method="post" id="addform" accept-charset="utf-8">
    <input type="text" name="name" id="modal_name">
    <input type="hidden" name="classname" id="modal_classname">
    <p><input type="submit" value="{% trans "Submit" %}"></p>
</form>
<div id="modal_errors"></div>
<a class="close-reveal-modal">&#215;</a>
</div>
{% endblock %}

{% block scriptend %}
$( "input:text[name=name]" ).autocomplete({
      minLength: 2,
      source: function( request, response ) {
        var term = request.term;
        Dajaxice.devices.complete_devicenames(response, {'name':term});
      }
    });
$("#id_devicetype").change(function() {
        Dajaxice.devicetypes.get_attributes(Dajax.process, {'pk':$(this).val()});
});

$(".modalbutton").click(function() {
    $('#addModal').foundation('reveal', 'open');
    $("#modal_name").val("");
    $("#modal_header").text($(this).data("name"))
    $("#modal_classname").val($(this).data("classname"));
});

$("select").select2();

$("#addform").submit(function() {
    Dajaxice.devices.add_device_field(Dajax.process,{'form':$(this).serialize(true)});
    return false;
});
{% endblock %}