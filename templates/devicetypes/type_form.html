{% extends "base.html" %}
{%  load devicetags %}
{% load i18n %}

{% block title %}{{actionstring}} {% if object != None %}{{object}}{% else %}Object{% endif %}{% endblock %}

{% block header %}{{actionstring}} {% if object != None %}{{object}}{% else %}Object{% endif %}{% endblock %}
{% block content %}
<div class="row">
  <div class="small-12 large-6 large-centered columns panel">
<form action="" method="post" class="form-horizontal" id="forms">{% csrf_token %}
{% for field in form %}
{% if field.html_name == "extra_fieldcount" %}
{{field}}
{% else %}
<div class="row {{field.css_classes}}">
        <div class="small-3 columns">
          <label for="right-label" class="right inline" {% if field.field.required %}style="font-weight:bold"{% endif %}>{{ field.label }}</label>
        </div>
        <div class="small-9 columns">
         {{ field }}
{% if field.errors %}<small style="padding-top:20px">{% for error in field.errors %}{{error}}, {% endfor %}</small>{% endif %}
        </div>
      </div>
{% endif %}
{% endfor %}
<input type="submit" value="{% trans "Submit" %}" class="button button-primary" />
<a href="#" id="newattribute" class="right">add new Attribute</a>
</form>
</div>
</div>
{% endblock %}

{% block scriptend %}
$( "input:text[name=name]" ).keyup(function() {
    if($(this).val().length > 1) {
        Dajaxice.devices.complete_names(Dajax.process,{'classtype':'{{type}}', 'name':$(this).val()})
    }
});

function display_alternatives(data){
    if ($("#alternatives").length == 0){
        $( "input:text[name=name]" ).after("\
<div class='alert-box alert' id='alternativebox'>There seem to be objects with similar name. Do you maybe mean one of those?\
<ul id='alternatives' style='margin-top:10px;'></ul>\
</div>")
    }
    $("#alternatives").empty()
    for (var i=0; i < data.length; i++) {
        $("#alternatives").append(data[i])
    };
}

form_count = $("[name=extra_fieldcount]").val();
// get extra form count so we know what index to use for the next item.
$('body').on('click', ".deleteattribute", function() {
    $(this).parents(".row:first").remove()

    form_count --;
    $("[name=extra_field_count]").val(form_count);
})

$("#newattribute").click(function() {
    element = $('<div class="row "><div class="small-3 columns"><label for="right-label" class="right inline">Extra Attribute</label></div><div class="small-8 columns"><input class="extra_attribute" type="text"></div><div class="small-1 columns"><a href="#" class="deleteattribute"><i class="icon-remove"></i></a></div></div>');
    element.find(".extra_attribute").attr('name', 'extra_field_' + form_count);
    if($(".extra_attribute")[0]) {
      $(".extra_attribute:last").parents(".row:first").after(element);
    } else {
      $("#id_name").parents(".row:first").after(element);
    }
    // build element and append it to our forms container

    form_count ++;
    $("[name=extra_fieldcount]").val(form_count);
    // increment form count so our view knows to populate 
    // that many fields for validatio
})

{% autoescape off %}{{ form_scripts }}{% endautoescape %}
{% endblock %}